import{r as y,u as G,j as e,d as C,X as Z,a as ee,e as se,s as te,b as ae}from"./index-DykhQkCz.js";import{B as q,M as L,P as E}from"./MobileLayout-D0P8EqVx.js";import{B as A,S as ne}from"./BottomNav-B9ClJoKd.js";import{P as oe}from"./plus-CKAhW2G1.js";import{U as b,T as B,P as F,R as I}from"./utensils-crossed-BFnIAvKJ.js";import{P as re}from"./PetAvatar-Bi96YrWD.js";import{P as le}from"./PetSelector-DeSwfx4H.js";import{i as w,s as ie,D as de}from"./DateSelector-AJ21rQkV.js";import{E as W,S as k}from"./SummaryCard-XhoA62hH.js";import{f as ce}from"./petAge-D-c7gpnm.js";import{u as me,a as ue,b as xe,c as pe}from"./useLogs-xxhwBdP6.js";import{u as he}from"./useCommunityFeed-BnvToe_v.js";import{d as fe}from"./differenceInCalendarDays-qwJqrl5B.js";import{f as c}from"./format-DsNdWjgr.js";import"./chevron-right-BDWtZfPp.js";import"./differenceInMonths-DSTze7pK.js";import"./rewards-DUz26ILh.js";const ge=[{path:"/add-food",icon:b,label:"Add Food",color:"bg-secondary"},{path:"/add-poop",icon:B,label:"Add Poop",color:"bg-accent-pink"},{path:"/add-supplement",icon:F,label:"Add Supplement",color:"bg-accent-blue"},{path:"/add-measurement",icon:I,label:"Add Measurement",color:"bg-card-muted"}];function je(){const[t,i]=y.useState(!1),m=G(),l=n=>{i(!1),m(n)};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"fixed inset-0 bg-foreground/20 backdrop-blur-sm z-40 animate-fade-in",onClick:()=>i(!1)}),e.jsx("div",{className:C("fixed right-6 z-50 flex flex-col-reverse items-end gap-3 transition-all duration-300",t?"bottom-24":"bottom-24 pointer-events-none opacity-0"),children:ge.map((n,o)=>e.jsxs("button",{onClick:()=>l(n.path),className:C("flex items-center gap-3 pr-4 pl-3 py-2.5 rounded-full shadow-lg transition-all",n.color,t?"animate-fade-up":"opacity-0"),style:{animationDelay:`${o*50}ms`},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-background/40 flex items-center justify-center",children:e.jsx(n.icon,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium text-sm",children:n.label})]},n.path))}),e.jsx(q,{size:"fab",className:C("fixed bottom-20 right-6 z-50 transition-transform duration-200",t&&"rotate-45"),onClick:()=>i(!t),children:t?e.jsx(Z,{className:"w-6 h-6"}):e.jsx(oe,{className:"w-6 h-6"})})]})}function ye(t){const{user:i}=ee(),m=se({queryKey:["pet_challenges",t],queryFn:async()=>{if(!i||!t)return[];const{data:l,error:n}=await te.from("pet_challenges").select("*").eq("pet_id",t).order("created_at",{ascending:!0});if(n)throw n;return(l||[]).map(o=>({id:o.id,petId:o.pet_id,title:o.title,subtitle:o.subtitle||void 0,progress:Number(o.progress??0),goal:Number(o.goal??1),streakDays:o.streak_days||void 0}))},enabled:!!i&&!!t});return{challenges:m.data??[],isLoading:m.isLoading,refetch:m.refetch}}function _e(){const t=G(),{pets:i,petsLoading:m,selectedPet:l,selectedPetId:n,setSelectedPetId:o,selectedDate:r,setSelectedDate:H}=ae(),{logs:$}=me(n),{logs:p}=ue(n),{logs:U}=xe(n),{logs:_}=pe(n),{challenges:z}=ye(n),{posts:Q}=he(),h=y.useMemo(()=>$.filter(s=>w(new Date(s.timestamp),r)),[$,r]),f=y.useMemo(()=>p.filter(s=>w(new Date(s.timestamp),r)),[p,r]),g=y.useMemo(()=>U.filter(s=>w(new Date(s.timestamp),r)),[U,r]),O=h.reduce((s,d)=>s+d.amountGrams,0),S=_.length>0?_[0].weightKg:null,u=Q[0],N={ok:{label:"On track",color:"bg-emerald-500"},watch:{label:"Watch",color:"bg-amber-400"},alert:{label:"Alert",color:"bg-rose-500"}},x=y.useMemo(()=>{const s=r,d=p.filter(a=>fe(s,new Date(a.timestamp))<=7),T=d.some(a=>a.bloodPresent||a.color==="black"||a.color==="red"||a.undesirableBehaviors&&a.undesirableBehaviors.length>0&&!a.undesirableBehaviors.includes("not_applicable")),X=!T&&d.some(a=>a.consistency==="diarrhea"||a.mucusPresent||["green","yellow","orange","white","grey","clay"].includes(a.color)),M=T?"alert":X?"watch":"ok",J=M==="alert"?"Recent stool logs contain high-risk markers (blood, tarry, or multiple undesirable behaviors).":M==="watch"?"Some logs show softer texture or unusual colors. Keep monitoring hydration and diet.":"Looks steady—recent entries stay within healthy color and texture ranges.",j=Array.from({length:3}).map((a,P)=>{const K=ie(s,P),v=p.filter(Y=>w(new Date(Y.timestamp),K)).length;let R="ok";return(v===0||v>3)&&(R=v===0?"alert":"watch"),{label:c(K,"EEE"),count:v,status:R}}),V=j.reduce((a,P)=>a+P.count,0)/(j.length||1),D=j.some(a=>a.status==="alert")?"alert":j.some(a=>a.status==="watch")?"watch":"ok";return{lookStatus:M,lookMessage:J,freqStatus:D,freqMessage:D==="alert"?"Log consistency suggests very low or no bowel movements. Check hydration and fiber.":D==="watch"?"Stool frequency hit the edges of the 1–3 logs/day range. Keep an eye on routines.":"Average stool frequency is within the target 1–3 per day.",freqSegments:j,avg:V}},[p,r]);return m?e.jsxs(L,{children:[e.jsx(E,{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})}),e.jsx(A,{})]}):!l||i.length===0?e.jsxs(L,{children:[e.jsx(E,{className:"flex items-center justify-center min-h-screen",children:e.jsx(W,{icon:b,title:"No pet yet",description:"Add your first pet to get started",action:e.jsx(q,{onClick:()=>t("/onboarding"),children:"Add Pet"})})}),e.jsx(A,{})]}):e.jsxs(L,{children:[e.jsx("header",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-lg px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hello!"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-xl font-display font-semibold",children:l.name}),l.dateOfBirth&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",ce(l.dateOfBirth),")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{photoUrl:l.photoUrl,name:l.name,size:"md"}),e.jsx("button",{onClick:()=>t("/settings"),className:"p-2 rounded-xl hover:bg-card-muted transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]})]})}),e.jsxs(E,{className:"space-y-6",children:[e.jsx(le,{pets:i,selectedPetId:n,onSelectPet:o}),e.jsx(de,{selectedDate:r,onDateChange:H}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(k,{icon:b,title:"Food",value:O>0?`${O}g`:"—",subtitle:h.length>0?`${h.length} meals`:"No meals today",onClick:()=>t("/add-food")}),e.jsx(k,{icon:B,title:"Poop",value:f.length>0?f.length.toString():"—",subtitle:f.length>0?"entries today":"No entries",onClick:()=>t("/add-poop")}),e.jsx(k,{icon:F,title:"Supplements",value:g.length>0?g.length.toString():"—",subtitle:g.length>0?"given today":"None given",onClick:()=>t("/add-supplement")}),e.jsx(k,{icon:I,title:"Weight",value:S?`${S}kg`:"—",subtitle:S?"Latest":"Not recorded",onClick:()=>t("/add-measurement")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>t("/pets"),className:"rounded-2xl bg-soycraft-cream text-soycraft-brown p-4 text-left shadow-soft transition hover:shadow-card",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"My pets"}),e.jsx("p",{className:"text-lg font-display",children:"Manage & add"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Update profiles or add a new buddy."})]}),e.jsxs("button",{onClick:()=>t("/community"),className:"rounded-full aspect-square bg-accent-pink/50 flex flex-col items-center justify-center text-center text-sm font-medium text-foreground shadow-soft mx-auto w-full max-w-[160px]",children:[e.jsx("span",{className:"text-xs uppercase text-muted-foreground",children:"Community"}),e.jsx("span",{className:"text-lg font-display",children:"Open feed"})]})]}),p.length>0&&e.jsxs("div",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-display font-medium",children:"Poop trend alerts"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Last 7 days"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Looks"}),e.jsx("span",{className:"font-semibold text-foreground",children:N[x.lookStatus].label})]}),e.jsx("div",{className:"h-2 rounded-full bg-card-muted overflow-hidden mt-2",children:e.jsx("div",{className:`h-full ${N[x.lookStatus].color}`})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:x.lookMessage})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Frequency"}),e.jsxs("span",{className:"font-semibold text-foreground",children:[N[x.freqStatus].label," • ",x.avg.toFixed(1)," avg/day"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-3",children:x.freqSegments.map(s=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-2 rounded-full bg-card-muted overflow-hidden",children:e.jsx("div",{className:`h-full ${N[s.status].color}`})}),e.jsx("p",{className:"text-[10px] uppercase mt-1 text-muted-foreground",children:s.label}),e.jsx("p",{className:"text-xs font-medium",children:s.count})]},s.label))}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:x.freqMessage})]})]}),z.length>0&&e.jsxs("div",{className:"card-nude",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-display font-medium",children:"Care challenges"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Build streaks to keep habits"})]}),e.jsx("div",{className:"space-y-3",children:z.slice(0,2).map(s=>{const d=Math.min(100,Math.round(s.progress/s.goal*100));return e.jsxs("div",{className:"p-3 rounded-xl bg-background/60",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),s.streakDays&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.streakDays," day streak"]})]}),s.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:s.subtitle}),e.jsx("div",{className:"w-full h-2 rounded-full bg-card-muted overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${d}%`}})})]},s.id)})})]}),u&&e.jsxs("div",{className:"card-nude space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-display font-medium",children:"Community spotlight"}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>t("/community"),children:"Open feed"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.ownerName," shared:"]}),e.jsx("p",{className:"text-sm",children:u.content}),u.photoUrl&&e.jsx("img",{src:u.photoUrl,alt:"Community post",className:"w-full h-40 object-cover rounded-xl"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c(new Date(u.createdAt),"MMM d, h:mm a")," • ",u.likes??0," cheers"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-display font-medium mb-4",children:c(r,"EEEE, MMM d")===c(new Date,"EEEE, MMM d")?"Today's Activity":c(r,"EEEE, MMM d")}),h.length===0&&f.length===0&&g.length===0?e.jsx(W,{icon:b,title:"No activity yet",description:"Start logging your pet's activities using the + button"}):e.jsx("div",{className:"space-y-3",children:[...h.map(s=>({...s,type:"food"})),...f.map(s=>({...s,type:"poop"})),...g.map(s=>({...s,type:"supplement"}))].sort((s,d)=>new Date(s.timestamp).getTime()-new Date(d.timestamp).getTime()).map(s=>s.type==="food"?e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-secondary/50",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-background flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.foodName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.amountGrams,"g • ",s.mealType]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c(new Date(s.timestamp),"h:mm a")})]},`food-${s.id}`):s.type==="poop"?e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-accent-pink/30",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-background flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Poop"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.consistency," • ",s.amount]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c(new Date(s.timestamp),"h:mm a")})]},`poop-${s.id}`):e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-accent/30",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-background flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.supplementName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.dosage})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:c(new Date(s.timestamp),"h:mm a")})]},`supp-${s.id}`))})]})]}),e.jsx(je,{}),e.jsx(A,{})]})}export{_e as default};
