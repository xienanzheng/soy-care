import{a as b,f as w,e as A,s as h,g as S,u as C,r as m,j as e,t as x}from"./index-DykhQkCz.js";import{M as g,a as v,P as y,B as _}from"./MobileLayout-D0P8EqVx.js";import{I as N}from"./input-BtP13zn0.js";import{P as F}from"./PhotoUpload-DYIKrCeN.js";import{u as q}from"./usePhotoUpload-Bns2eVj-.js";import{A as j}from"./arrow-left-CdLBjOwR.js";function E(){const{user:a}=b(),n=w(),i=A({queryKey:["profile",a==null?void 0:a.id],queryFn:async()=>{if(!a)return null;const{data:t,error:r}=await h.from("profiles").select("*").eq("user_id",a.id).maybeSingle();if(r)throw r;return t?{id:t.id,userId:t.user_id,displayName:t.display_name,avatarUrl:t.avatar_url,createdAt:t.created_at,updatedAt:t.updated_at}:null},enabled:!!a}),d=S({mutationFn:async({displayName:t,avatarUrl:r})=>{if(!a)throw new Error("Not authenticated");const{data:c,error:l}=await h.from("profiles").update({display_name:t,avatar_url:r,updated_at:new Date().toISOString()}).eq("user_id",a.id).select().single();if(l)throw l;return c},onSuccess:()=>{n.invalidateQueries({queryKey:["profile",a==null?void 0:a.id]})}});return{profile:i.data,isLoading:i.isLoading,error:i.error,updateProfile:d.mutateAsync,isUpdating:d.isPending}}function B(){const a=C(),{user:n}=b(),{profile:i,isLoading:d,updateProfile:t,isUpdating:r}=E(),{uploadPhoto:c,isUploading:l}=q(),[p,U]=m.useState(null),[o,u]=m.useState({displayName:"",avatarUrl:""});m.useEffect(()=>{i&&u({displayName:i.displayName||"",avatarUrl:i.avatarUrl||""})},[i]);const P=async()=>{try{let s=o.avatarUrl;if(p){const f=await c(p,"pet-photos","avatars");f&&(s=f)}await t({displayName:o.displayName||void 0,avatarUrl:s||void 0}),x({title:"Profile updated!",description:"Your profile has been saved."}),a("/settings")}catch(s){x({title:"Failed to update profile",description:s.message,variant:"destructive"})}};return d?e.jsxs(g,{children:[e.jsx(v,{leftAction:e.jsx("button",{onClick:()=>a("/settings"),className:"p-2 -ml-2",children:e.jsx(j,{className:"w-5 h-5"})}),title:"Account"}),e.jsx(y,{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading..."})})]}):e.jsxs(g,{children:[e.jsx(v,{leftAction:e.jsx("button",{onClick:()=>a("/settings"),className:"p-2 -ml-2",children:e.jsx(j,{className:"w-5 h-5"})}),title:"Account"}),e.jsxs(y,{className:"flex flex-col pb-8",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(F,{value:o.avatarUrl,onChange:s=>u({...o,avatarUrl:s||""}),onFileSelect:s=>U(s),isUploading:l,size:"lg",shape:"circle",placeholder:"Add photo"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Email"}),e.jsx(N,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"bg-card-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Display Name"}),e.jsx(N,{placeholder:"e.g., Taylor Chen",value:o.displayName,onChange:s=>u({...o,displayName:s.target.value})})]}),e.jsx(_,{onClick:P,disabled:r||l,className:"w-full",children:r||l?"Saving...":"Save Changes"})]})]})}export{B as default};
