import{u as w,b as C,r as d,j as e,X as D,d as h,t as n}from"./index-DykhQkCz.js";import{M,a as A,P as q,B as F}from"./MobileLayout-D0P8EqVx.js";import{I as l}from"./input-BtP13zn0.js";import{P as O}from"./PetSelector-DeSwfx4H.js";import{P as E}from"./PhotoUpload-DYIKrCeN.js";import{b as I,d as U}from"./useLogs-xxhwBdP6.js";import{u as T}from"./usePhotoUpload-Bns2eVj-.js";import{f as x}from"./format-DsNdWjgr.js";import"./PetAvatar-Bi96YrWD.js";import"./plus-CKAhW2G1.js";import"./differenceInCalendarDays-qwJqrl5B.js";import"./rewards-DUz26ILh.js";const L=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"as_needed",label:"As Needed"}],$=["Probiotics","Fish Oil","Glucosamine","Multivitamin","Psyllium Husk","Coconut Oil"];function K(){const m=w(),{pets:g,selectedPet:b,selectedPetId:o,setSelectedPetId:f}=C(),{createLog:v,isCreating:c}=I(o),{uploadPhoto:j,isUploading:r}=T(),[u,N]=d.useState(null),[y,P]=d.useState(null),[t,a]=d.useState({supplementName:"",customName:"",dosage:"",frequency:"daily",notes:"",date:x(new Date,"yyyy-MM-dd"),time:new Date().toTimeString().slice(0,5),purpose:""}),S=async()=>{if(!b||!o){n({title:"No pet selected",variant:"destructive"});return}const s=t.customName||t.supplementName;if(!s||!t.dosage){n({title:"Please fill in required fields",variant:"destructive"});return}try{let i;if(u){const p=await j(u,"log-photos","supplements");p&&(i=p)}const k=new Date(`${t.date}T${t.time}`).toISOString();await v({petId:o,supplementName:s,dosage:t.dosage,frequency:t.frequency,notes:t.notes||void 0,photoUrl:i,timestamp:k,purpose:t.purpose||void 0}),n({title:"Supplement added",description:`${s} - ${t.dosage}`}),m("/dashboard")}catch(i){n({title:"Failed to add supplement",description:i.message,variant:"destructive"})}};return e.jsxs(M,{children:[e.jsx(A,{title:"Add Supplements",leftAction:e.jsx("button",{onClick:()=>m(-1),className:"p-2 -ml-2",children:e.jsx(D,{className:"w-5 h-5"})})}),e.jsxs(q,{className:"space-y-6",children:[e.jsx(O,{pets:g,selectedPetId:o,onSelectPet:f,showAddButton:!1}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date"}),e.jsx(l,{type:"date",placeholder:"2024-05-01",value:t.date,onChange:s=>a({...t,date:s.target.value}),max:x(U(new Date,1),"yyyy-MM-dd")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time"}),e.jsx(l,{type:"time",placeholder:"08:30",value:t.time,onChange:s=>a({...t,time:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Supplement"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(s=>e.jsx("button",{onClick:()=>a({...t,supplementName:s,customName:""}),className:h("px-4 py-2 rounded-full text-sm font-medium transition-all",t.supplementName===s?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Or enter custom supplement"}),e.jsx(l,{placeholder:"e.g., Vitamin E",value:t.customName,onChange:s=>a({...t,customName:s.target.value,supplementName:""})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Dosage"}),e.jsx(l,{placeholder:"e.g., 1 tablespoon",value:t.dosage,onChange:s=>a({...t,dosage:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Purpose / reason"}),e.jsx(l,{placeholder:"e.g., gut health",value:t.purpose,onChange:s=>a({...t,purpose:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Frequency"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.map(s=>e.jsx("button",{onClick:()=>a({...t,frequency:s.value}),className:h("px-4 py-3 rounded-xl text-sm font-medium transition-all",t.frequency===s.value?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Additional Notes"}),e.jsx("textarea",{placeholder:"e.g., Give with dinner if tummy is upset",value:t.notes,onChange:s=>a({...t,notes:s.target.value}),className:"w-full h-24 rounded-xl bg-card-subtle px-4 py-3 text-foreground placeholder:text-muted-foreground resize-none focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Photo (optional)"}),e.jsx(E,{value:y,onChange:P,onFileSelect:N,isUploading:r,size:"lg",shape:"square",className:"w-full h-32"})]}),e.jsx(F,{onClick:S,className:"w-full mt-8",disabled:c||r,children:c||r?"Adding...":"Add Supplements"})]})]})}export{K as default};
