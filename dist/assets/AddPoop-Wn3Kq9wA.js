import{h as pe,i as xe,r as f,k as ve,j as e,l as _,m as I,P as T,n as ge,d as D,u as Se,b as ye,X as je,t as L}from"./index-DykhQkCz.js";import{M as we,a as Ne,P as Pe,B as G}from"./MobileLayout-D0P8EqVx.js";import{I as O}from"./input-BtP13zn0.js";import{P as Re}from"./PetSelector-DeSwfx4H.js";import{P as Ce}from"./PhotoUpload-DYIKrCeN.js";import{R as ke}from"./RatingSlider-n_BkI6Xs.js";import{a as Be,d as De}from"./useLogs-xxhwBdP6.js";import{u as _e}from"./usePhotoUpload-Bns2eVj-.js";import{u as Ie,c as J}from"./index-Cqgnfz2u.js";import{u as Ae,S as X}from"./switch-DUxLsqSW.js";import{S as Ee}from"./sparkles-DVQITgTg.js";import{f as q}from"./format-DsNdWjgr.js";import"./PetAvatar-Bi96YrWD.js";import"./plus-CKAhW2G1.js";import"./differenceInCalendarDays-qwJqrl5B.js";import"./rewards-DUz26ILh.js";var Q=["PageUp","PageDown"],Z=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ee={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},A="Slider",[H,Me,Te]=pe(A),[te,St]=xe(A,[Te]),[Le,V]=te(A),se=f.forwardRef((s,n)=>{const{name:r,min:a=0,max:d=100,step:u=1,orientation:l="horizontal",disabled:c=!1,minStepsBetweenThumbs:m=0,defaultValue:x=[a],value:g,onValueChange:i=()=>{},onValueCommit:b=()=>{},inverted:o=!1,form:h,...S}=s,v=f.useRef(new Set),t=f.useRef(0),p=l==="horizontal"?Oe:Ve,[y=[],P]=ve({prop:g,defaultProp:x,onChange:w=>{var k;(k=[...v.current][t.current])==null||k.focus(),i(w)}}),N=f.useRef(y);function K(w){const R=Fe(y,w);E(w,R)}function he(w){E(w,t.current)}function be(){const w=N.current[t.current];y[t.current]!==w&&b(y)}function E(w,R,{commit:k}={commit:!1}){const Y=Ge(u),U=Xe(Math.round((w-a)/u)*u+a,Y),M=J(U,[a,d]);P((B=[])=>{const C=He(B,M,R);if(We(C,m*u)){t.current=C.indexOf(M);const W=String(C)!==String(B);return W&&k&&b(C),W?C:B}else return B})}return e.jsx(Le,{scope:s.__scopeSlider,name:r,disabled:c,min:a,max:d,valueIndexToChangeRef:t,thumbs:v.current,values:y,orientation:l,form:h,children:e.jsx(H.Provider,{scope:s.__scopeSlider,children:e.jsx(H.Slot,{scope:s.__scopeSlider,children:e.jsx(p,{"aria-disabled":c,"data-disabled":c?"":void 0,...S,ref:n,onPointerDown:_(S.onPointerDown,()=>{c||(N.current=y)}),min:a,max:d,inverted:o,onSlideStart:c?void 0:K,onSlideMove:c?void 0:he,onSlideEnd:c?void 0:be,onHomeKeyDown:()=>!c&&E(a,0,{commit:!0}),onEndKeyDown:()=>!c&&E(d,y.length-1,{commit:!0}),onStepKeyDown:({event:w,direction:R})=>{if(!c){const U=Q.includes(w.key)||w.shiftKey&&Z.includes(w.key)?10:1,M=t.current,B=y[M],C=u*U*R;E(B+C,M,{commit:!0})}}})})})})});se.displayName=A;var[oe,ne]=te(A,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Oe=f.forwardRef((s,n)=>{const{min:r,max:a,dir:d,inverted:u,onSlideStart:l,onSlideMove:c,onSlideEnd:m,onStepKeyDown:x,...g}=s,[i,b]=f.useState(null),o=I(n,p=>b(p)),h=f.useRef(void 0),S=Ie(d),v=S==="ltr",t=v&&!u||!v&&u;function j(p){const y=h.current||i.getBoundingClientRect(),P=[0,y.width],K=$(P,t?[r,a]:[a,r]);return h.current=y,K(p-y.left)}return e.jsx(oe,{scope:s.__scopeSlider,startEdge:t?"left":"right",endEdge:t?"right":"left",direction:t?1:-1,size:"width",children:e.jsx(ae,{dir:S,"data-orientation":"horizontal",...g,ref:o,style:{...g.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:p=>{const y=j(p.clientX);l==null||l(y)},onSlideMove:p=>{const y=j(p.clientX);c==null||c(y)},onSlideEnd:()=>{h.current=void 0,m==null||m()},onStepKeyDown:p=>{const P=ee[t?"from-left":"from-right"].includes(p.key);x==null||x({event:p,direction:P?-1:1})}})})}),Ve=f.forwardRef((s,n)=>{const{min:r,max:a,inverted:d,onSlideStart:u,onSlideMove:l,onSlideEnd:c,onStepKeyDown:m,...x}=s,g=f.useRef(null),i=I(n,g),b=f.useRef(void 0),o=!d;function h(S){const v=b.current||g.current.getBoundingClientRect(),t=[0,v.height],p=$(t,o?[a,r]:[r,a]);return b.current=v,p(S-v.top)}return e.jsx(oe,{scope:s.__scopeSlider,startEdge:o?"bottom":"top",endEdge:o?"top":"bottom",size:"height",direction:o?1:-1,children:e.jsx(ae,{"data-orientation":"vertical",...x,ref:i,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const v=h(S.clientY);u==null||u(v)},onSlideMove:S=>{const v=h(S.clientY);l==null||l(v)},onSlideEnd:()=>{b.current=void 0,c==null||c()},onStepKeyDown:S=>{const t=ee[o?"from-bottom":"from-top"].includes(S.key);m==null||m({event:S,direction:t?-1:1})}})})}),ae=f.forwardRef((s,n)=>{const{__scopeSlider:r,onSlideStart:a,onSlideMove:d,onSlideEnd:u,onHomeKeyDown:l,onEndKeyDown:c,onStepKeyDown:m,...x}=s,g=V(A,r);return e.jsx(T.span,{...x,ref:n,onKeyDown:_(s.onKeyDown,i=>{i.key==="Home"?(l(i),i.preventDefault()):i.key==="End"?(c(i),i.preventDefault()):Q.concat(Z).includes(i.key)&&(m(i),i.preventDefault())}),onPointerDown:_(s.onPointerDown,i=>{const b=i.target;b.setPointerCapture(i.pointerId),i.preventDefault(),g.thumbs.has(b)?b.focus():a(i)}),onPointerMove:_(s.onPointerMove,i=>{i.target.hasPointerCapture(i.pointerId)&&d(i)}),onPointerUp:_(s.onPointerUp,i=>{const b=i.target;b.hasPointerCapture(i.pointerId)&&(b.releasePointerCapture(i.pointerId),u(i))})})}),re="SliderTrack",le=f.forwardRef((s,n)=>{const{__scopeSlider:r,...a}=s,d=V(re,r);return e.jsx(T.span,{"data-disabled":d.disabled?"":void 0,"data-orientation":d.orientation,...a,ref:n})});le.displayName=re;var z="SliderRange",ie=f.forwardRef((s,n)=>{const{__scopeSlider:r,...a}=s,d=V(z,r),u=ne(z,r),l=f.useRef(null),c=I(n,l),m=d.values.length,x=d.values.map(b=>ue(b,d.min,d.max)),g=m>1?Math.min(...x):0,i=100-Math.max(...x);return e.jsx(T.span,{"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,...a,ref:c,style:{...s.style,[u.startEdge]:g+"%",[u.endEdge]:i+"%"}})});ie.displayName=z;var F="SliderThumb",ce=f.forwardRef((s,n)=>{const r=Me(s.__scopeSlider),[a,d]=f.useState(null),u=I(n,c=>d(c)),l=f.useMemo(()=>a?r().findIndex(c=>c.ref.current===a):-1,[r,a]);return e.jsx(Ke,{...s,ref:u,index:l})}),Ke=f.forwardRef((s,n)=>{const{__scopeSlider:r,index:a,name:d,...u}=s,l=V(F,r),c=ne(F,r),[m,x]=f.useState(null),g=I(n,j=>x(j)),i=m?l.form||!!m.closest("form"):!0,b=ge(m),o=l.values[a],h=o===void 0?0:ue(o,l.min,l.max),S=ze(a,l.values.length),v=b==null?void 0:b[c.size],t=v?$e(v,h,c.direction):0;return f.useEffect(()=>{if(m)return l.thumbs.add(m),()=>{l.thumbs.delete(m)}},[m,l.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${h}% + ${t}px)`},children:[e.jsx(H.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(T.span,{role:"slider","aria-label":s["aria-label"]||S,"aria-valuemin":l.min,"aria-valuenow":o,"aria-valuemax":l.max,"aria-orientation":l.orientation,"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,tabIndex:l.disabled?void 0:0,...u,ref:g,style:o===void 0?{display:"none"}:s.style,onFocus:_(s.onFocus,()=>{l.valueIndexToChangeRef.current=a})})}),i&&e.jsx(de,{name:d??(l.name?l.name+(l.values.length>1?"[]":""):void 0),form:l.form,value:o},a)]})});ce.displayName=F;var Ue="RadioBubbleInput",de=f.forwardRef(({__scopeSlider:s,value:n,...r},a)=>{const d=f.useRef(null),u=I(d,a),l=Ae(n);return f.useEffect(()=>{const c=d.current;if(!c)return;const m=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(m,"value").set;if(l!==n&&g){const i=new Event("input",{bubbles:!0});g.call(c,n),c.dispatchEvent(i)}},[l,n]),e.jsx(T.input,{style:{display:"none"},...r,ref:u,defaultValue:n})});de.displayName=Ue;function He(s=[],n,r){const a=[...s];return a[r]=n,a.sort((d,u)=>d-u)}function ue(s,n,r){const u=100/(r-n)*(s-n);return J(u,[0,100])}function ze(s,n){return n>2?`Value ${s+1} of ${n}`:n===2?["Minimum","Maximum"][s]:void 0}function Fe(s,n){if(s.length===1)return 0;const r=s.map(d=>Math.abs(d-n)),a=Math.min(...r);return r.indexOf(a)}function $e(s,n,r){const a=s/2,u=$([0,50],[0,a]);return(a-u(n)*r)*r}function Ye(s){return s.slice(0,-1).map((n,r)=>s[r+1]-n)}function We(s,n){if(n>0){const r=Ye(s);return Math.min(...r)>=n}return!0}function $(s,n){return r=>{if(s[0]===s[1]||n[0]===n[1])return n[0];const a=(n[1]-n[0])/(s[1]-s[0]);return n[0]+a*(r-s[0])}}function Ge(s){return(String(s).split(".")[1]||"").length}function Xe(s,n){const r=Math.pow(10,n);return Math.round(s*r)/r}var me=se,qe=le,Je=ie,Qe=ce;const fe=f.forwardRef(({className:s,...n},r)=>e.jsxs(me,{ref:r,className:D("relative flex w-full touch-none select-none items-center",s),...n,children:[e.jsx(qe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Je,{className:"absolute h-full bg-primary"})}),e.jsx(Qe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));fe.displayName=me.displayName;const Ze=[{value:"regular",label:"Regular"},{value:"soft",label:"Soft"},{value:"sticky",label:"Sticky"},{value:"hard",label:"Hard"},{value:"diarrhea",label:"Diarrhea"}],et=[{value:"brown",label:"Brown"},{value:"dark_brown",label:"Dark Brown"},{value:"light_brown",label:"Light Brown"},{value:"black",label:"Black / Tarry"},{value:"red",label:"Red / Bloody"},{value:"green",label:"Green"},{value:"yellow",label:"Yellow"},{value:"orange",label:"Orange"},{value:"white",label:"White"},{value:"grey",label:"Grey"},{value:"clay",label:"Clay"}],tt=[{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"}],st=[{value:"dry",label:"Dry"},{value:"normal",label:"Normal"},{value:"wet",label:"Wet"}],ot=[{value:"not_applicable",label:"Not applicable"},{value:"undesirable_behavior",label:"Undesirable behavior"},{value:"lip_paws",label:"Lip paws"},{value:"vomit",label:"Vomit"},{value:"other",label:"Others"}];function yt(){const s=Se(),{pets:n,selectedPet:r,selectedPetId:a,setSelectedPetId:d}=ye(),{createLog:u,isCreating:l}=Be(a),{uploadPhoto:c,isUploading:m}=_e(),[x,g]=f.useState(null),[i,b]=f.useState(null),[o,h]=f.useState({consistency:"",color:"",amount:"",location:"",notes:"",userRating:void 0,date:q(new Date,"yyyy-MM-dd"),time:new Date().toTimeString().slice(0,5),moistureLevel:"",bloodPresent:!1,mucusPresent:!1,smellLevel:3,undesirableBehaviors:[],undesirableBehaviorNotes:""}),S=t=>{h(j=>{if(t==="not_applicable"){const N=j.undesirableBehaviors.includes(t);return{...j,undesirableBehaviors:N?[]:["not_applicable"],undesirableBehaviorNotes:N?j.undesirableBehaviorNotes:""}}const p=j.undesirableBehaviors.filter(N=>N!=="not_applicable"),P=p.includes(t)?p.filter(N=>N!==t):[...p,t];return{...j,undesirableBehaviors:P,undesirableBehaviorNotes:P.includes("other")?j.undesirableBehaviorNotes:""}})},v=async()=>{if(!r||!a){L({title:"No pet selected",variant:"destructive"});return}if(!o.consistency||!o.color||!o.amount){L({title:"Please select consistency, color, and amount",variant:"destructive"});return}try{let t;if(x){const p=await c(x,"log-photos","poop");p&&(t=p)}const j=new Date(`${o.date}T${o.time}`).toISOString();await u({petId:a,consistency:o.consistency,color:o.color,amount:o.amount,location:o.location,notes:o.notes||void 0,photoUrl:t,userRating:o.userRating,timestamp:j,aiStatus:"not_requested",moistureLevel:o.moistureLevel||void 0,bloodPresent:o.bloodPresent,mucusPresent:o.mucusPresent,smellLevel:o.smellLevel,undesirableBehaviors:o.undesirableBehaviors.length?o.undesirableBehaviors:void 0,undesirableBehaviorNotes:o.undesirableBehaviorNotes||void 0}),L({title:"Poop log added",description:`${o.consistency} - ${o.amount}`}),s("/dashboard")}catch(t){L({title:"Failed to add log",description:t.message,variant:"destructive"})}};return e.jsxs(we,{children:[e.jsx(Ne,{title:"Add Poop",leftAction:e.jsx("button",{onClick:()=>s(-1),className:"p-2 -ml-2",children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs(Pe,{className:"space-y-6",children:[e.jsx(Re,{pets:n,selectedPetId:a,onSelectPet:d,showAddButton:!1}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Date"}),e.jsx(O,{type:"date",placeholder:"2024-05-01",value:o.date,onChange:t=>h({...o,date:t.target.value}),max:q(De(new Date,1),"yyyy-MM-dd")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Time"}),e.jsx(O,{type:"time",placeholder:"08:30",value:o.time,onChange:t=>h({...o,time:t.target.value})})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-accent-pink/30 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-secondary flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"AI Health Insights"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload a clear photo to unlock AI stool analysis inside the Analytics Lab."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Photo (recommended for AI)"}),e.jsx(Ce,{value:i,onChange:b,onFileSelect:g,isUploading:m,size:"lg",shape:"square",className:"w-full h-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Consistency"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ze.map(t=>e.jsx("button",{onClick:()=>h({...o,consistency:t.value}),className:D("px-4 py-3 rounded-xl text-sm font-medium transition-all",o.consistency===t.value?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Color"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:et.map(t=>e.jsx("button",{onClick:()=>h({...o,color:t.value}),className:D("px-4 py-2 rounded-full text-sm font-medium transition-all",o.color===t.value?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Amount"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:tt.map(t=>e.jsx("button",{onClick:()=>h({...o,amount:t.value}),className:D("px-4 py-3 rounded-xl text-sm font-medium transition-all",o.amount===t.value?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Moisture level"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:st.map(t=>e.jsx("button",{onClick:()=>h({...o,moistureLevel:t.value}),className:D("px-4 py-2 rounded-xl text-sm font-medium transition-all",o.moistureLevel===t.value?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:t.label},t.value))})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Smell intensity"}),e.jsx(fe,{min:1,max:5,step:1,value:[o.smellLevel],onValueChange:t=>h({...o,smellLevel:t[0]||1})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"Mild"}),e.jsx("span",{children:"Strong"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-card-subtle px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Blood spotted?"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Weâ€™ll highlight this in AI summaries."})]}),e.jsx(X,{checked:o.bloodPresent,onCheckedChange:t=>h({...o,bloodPresent:t})})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-card-subtle px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Mucus present?"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Helps identify inflammation issues."})]}),e.jsx(X,{checked:o.mucusPresent,onCheckedChange:t=>h({...o,mucusPresent:t})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Undesirable behavior"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ot.map(t=>e.jsx("button",{type:"button",onClick:()=>S(t.value),className:D("px-4 py-2 rounded-xl text-sm font-medium transition-all text-left",o.undesirableBehaviors.includes(t.value)?"bg-primary text-primary-foreground":"bg-card-muted hover:bg-card-subtle"),children:t.label},t.value))}),o.undesirableBehaviors.includes("other")&&e.jsx(O,{className:"mt-3",placeholder:"Describe the behavior",value:o.undesirableBehaviorNotes,onChange:t=>h({...o,undesirableBehaviorNotes:t.target.value})})]}),e.jsx(ke,{value:o.userRating,onChange:t=>h({...o,userRating:t})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Location"}),e.jsx(O,{placeholder:"e.g., Backyard, Walk",value:o.location,onChange:t=>h({...o,location:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Additional Notes"}),e.jsx("textarea",{placeholder:"e.g., Noticed a tiny streak of mucus",value:o.notes,onChange:t=>h({...o,notes:t.target.value}),className:"w-full h-24 rounded-xl bg-card-subtle px-4 py-3 text-foreground placeholder:text-muted-foreground resize-none focus:outline-none focus:ring-2 focus:ring-primary/20"})]}),e.jsx(G,{onClick:v,className:"w-full mt-8",disabled:l||m,children:l||m?"Adding...":"Add Poop"}),e.jsx(G,{variant:"secondary",onClick:()=>s("/add-supplement"),className:"w-full",children:"Add Supplements"})]})]})}export{yt as default};
