import{c as h,a as I,f as V,e as F,s as A,g as Q,b as R,r as p,j as e,t as c}from"./index-DykhQkCz.js";import{M as U,a as $,P as K,B as x}from"./MobileLayout-D0P8EqVx.js";import{B as O}from"./BottomNav-B9ClJoKd.js";import{u as W,a as Y,B as q,f as Z}from"./useVetChat-xWDf4eIf.js";import{I as g}from"./input-BtP13zn0.js";import{T as j}from"./textarea-Cn23d7ZC.js";import{f as L}from"./format-DsNdWjgr.js";import"./differenceInMonths-DSTze7pK.js";import"./differenceInCalendarDays-qwJqrl5B.js";import"./rewards-DUz26ILh.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=h("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=h("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"4oyue0"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=h("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=h("MessageSquareText",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M13 8H7",key:"14i4kc"}],["path",{d:"M17 12H7",key:"16if0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=h("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"pqwjuv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=h("ShieldPlus",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9 12h6",key:"1c52cq"}],["path",{d:"M12 9v6",key:"199k2o"}]]);function ae(){const{user:a}=I(),m=V(),n=F({queryKey:["vet-contact",a==null?void 0:a.id],enabled:!!a,queryFn:async()=>{if(!a)return null;const{data:s,error:l}=await A.from("user_vet_contacts").select("*").eq("user_id",a.id).maybeSingle();if(l)throw l;return s?{id:s.id,vetName:s.vet_name,clinic:s.clinic,phone:s.phone,email:s.email,address:s.address,notes:s.notes}:null}}),u=Q({mutationFn:async s=>{if(!a)throw new Error("Not authenticated");const{data:l,error:i}=await A.from("user_vet_contacts").upsert({user_id:a.id,vet_name:s.vetName??null,clinic:s.clinic??null,phone:s.phone??null,email:s.email??null,address:s.address??null,notes:s.notes??null},{onConflict:"user_id"}).select().single();if(i)throw i;return l},onSuccess:()=>{m.invalidateQueries({queryKey:["vet-contact",a==null?void 0:a.id]})}});return{contact:n.data,isLoading:n.isLoading,saveContact:u.mutateAsync,isSaving:u.isPending}}const ne={vetName:"",clinic:"",phone:"",email:"",address:"",notes:""};function xe(){const{selectedPet:a,selectedPetId:m}=R(),{metrics:n,transactions:u,claimDaily:s,isClaiming:l}=W(),{contact:i,saveContact:H,isSaving:N}=ae(),{activeThread:v,messages:k,startThread:T,sendMessage:D,isStarting:b,isSending:w,threads:M}=Y(m),[d,o]=p.useState(ne),[f,C]=p.useState(""),[y,S]=p.useState("");p.useEffect(()=>{i&&o({vetName:i.vetName??"",clinic:i.clinic??"",phone:i.phone??"",email:i.email??"",address:i.address??"",notes:i.notes??""})},[i]);const P=async()=>{try{await H(d),c({title:"Vet contact saved"})}catch(t){c({title:"Unable to save",description:t.message,variant:"destructive"})}},z=async()=>{try{await s(),c({title:"Credits added",description:"Thanks for checking in today!"})}catch(t){c({title:"Already claimed?",description:t.message||"You can only claim once per day.",variant:"destructive"})}},_=async()=>{if(!m){c({title:"Select a pet first",description:"Choose a pet so vets can tailor their reply.",variant:"destructive"});return}if(!f.trim()){c({title:"Add a quick summary",description:"Let the vet know what is going on."});return}try{await T({petId:m,topic:`${(a==null?void 0:a.name)??"My pet"} • urgent care`,initialMessage:f.trim(),creditCost:25}),c({title:"Chat opened",description:"A vet will join shortly. We deducted 25 credits."}),C("")}catch(t){c({title:"Unable to start chat",description:t.message||"Check your credit balance.",variant:"destructive"})}},B=async()=>{if(y.trim())try{await D({message:y.trim()}),S("")}catch(t){c({title:"Message failed",description:t.message,variant:"destructive"})}},E=p.useMemo(()=>n!=null&&n.consecutiveDays?`${n.consecutiveDays} day streak`:"Start streak",[n]);return e.jsxs(U,{children:[e.jsx($,{title:"Care hub",subtitle:"Rewards, local vets and live help"}),e.jsxs(K,{className:"space-y-6 pb-24",children:[e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase text-muted-foreground flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"})," Daily streak"]}),e.jsx("h3",{className:"font-display text-lg",children:"Keep logging, earn credits"})]}),e.jsx(q,{variant:"secondary",children:E})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center",children:[e.jsxs("div",{className:"rounded-xl bg-background/70 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Credits"}),e.jsx("p",{className:"text-2xl font-semibold",children:(n==null?void 0:n.credits)??0})]}),e.jsxs("div",{className:"rounded-xl bg-background/70 p-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entries logged"}),e.jsx("p",{className:"text-2xl font-semibold",children:(n==null?void 0:n.totalEntries)??0})]})]}),e.jsx(x,{onClick:z,disabled:l,className:"w-full",children:l?"Claiming…":"Claim daily boost (+5 credits)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Log food, poop, supplements or measurements daily to earn automatic credit bonuses."})]}),e.jsxs("section",{className:"card-nude space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"font-display flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Credits activity"]})}),u.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No credit history yet. Log some care to unlock rewards."}):e.jsx("div",{className:"space-y-2",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-background/70 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.reason??"Activity bonus"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z(new Date(t.createdAt),{addSuffix:!0})})]}),e.jsx("span",{className:t.delta>=0?"text-emerald-600 font-semibold":"text-destructive font-semibold",children:t.delta>0?`+${t.delta}`:t.delta})]},t.id))})]}),e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-display flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"My trusted vet"]}),e.jsx(x,{size:"sm",variant:"secondary",onClick:P,disabled:N,children:N?"Saving…":"Save"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{placeholder:"e.g., Dr. Ana Lopez",value:d.vetName,onChange:t=>o(r=>({...r,vetName:t.target.value}))}),e.jsx(g,{placeholder:"e.g., Sunset Animal Clinic",value:d.clinic,onChange:t=>o(r=>({...r,clinic:t.target.value}))}),e.jsx(g,{placeholder:"e.g., 415-555-0199",value:d.phone,onChange:t=>o(r=>({...r,phone:t.target.value}))}),e.jsx(g,{placeholder:"e.g., hello@sunsetvet.com",value:d.email,onChange:t=>o(r=>({...r,email:t.target.value}))}),e.jsx(g,{placeholder:"e.g., 123 Market St, San Francisco",value:d.address,onChange:t=>o(r=>({...r,address:t.target.value}))}),e.jsx(j,{placeholder:"e.g., Prefers texts before weekend emergencies",value:d.notes,onChange:t=>o(r=>({...r,notes:t.target.value})),rows:3})]})]}),e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-display flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"Real vet chat"]}),e.jsxs(q,{variant:"outline",children:[M.length," thread",M.length===1?"":"s"]})]}),v?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-xl bg-background/70 p-3",children:[e.jsx("p",{className:"text-sm font-medium",children:"Current case"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[v.topic||"Awaiting vet assignment"," • opened"," ",L(new Date(v.createdAt),"MMM d, h:mm a")]})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto space-y-2 pr-1",children:[k.map(t=>e.jsxs("div",{className:`rounded-2xl px-3 py-2 text-sm ${t.senderType==="vet"?"bg-primary/90 text-primary-foreground":"bg-background/80"}`,children:[t.message,e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:L(new Date(t.createdAt),"MMM d, h:mm a")})]},t.id)),k.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Waiting for your first update."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{value:y,onChange:t=>S(t.target.value),placeholder:"Share an update or respond to your vet",rows:3}),e.jsx(x,{onClick:B,disabled:w||!y.trim(),children:w?"Sending…":"Send"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Have a concern that needs a human touch? Open a conversation with a licensed vet (25 credits)."}),e.jsx(j,{value:f,onChange:t=>C(t.target.value),placeholder:"Describe the issue or upload details",rows:4}),e.jsx(x,{onClick:_,disabled:b,children:b?"Connecting…":"Open vet chat (25 credits)"})]})]}),e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("h3",{className:"font-display",children:"How to earn more credits"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-2 list-disc list-inside",children:[e.jsx("li",{children:"Log meals, poop, supplements or measurements daily (+2 to +5)."}),e.jsx("li",{children:"Upload stool photos for AI review (+3)."}),e.jsx("li",{children:"Maintain a 7 day streak for a 15 credit boost."})]}),e.jsxs(x,{variant:"ghost",className:"gap-2 justify-start",onClick:()=>c({title:"Log activity",description:"Use the + button on the home screen to log items."}),children:[e.jsx(G,{className:"w-4 h-4"}),"Quick log shortcut"]})]})]}),e.jsx(O,{})]})}export{xe as default};
