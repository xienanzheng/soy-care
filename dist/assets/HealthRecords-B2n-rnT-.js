import{c as ce,a as $,f as B,e as z,g as _,s as w,b as le,r as N,j as e,t as c}from"./index-DykhQkCz.js";import{M as re,a as de,P as oe,B as j}from"./MobileLayout-D0P8EqVx.js";import{P as ue}from"./PetSelector-DeSwfx4H.js";import{B as me}from"./BottomNav-B9ClJoKd.js";import{I as m}from"./input-BtP13zn0.js";import{T as P}from"./textarea-Cn23d7ZC.js";import{D as L,a as F,c as E,d as T,e as H}from"./dialog-C6CGz7Ks.js";import{u as K}from"./usePhotoUpload-Bns2eVj-.js";import{P as O}from"./plus-CKAhW2G1.js";import{T as Q}from"./trash-2-AfDv_LSy.js";import{F as ve}from"./file-text-BBf4xlqY.js";import{f}from"./format-DsNdWjgr.js";import"./PetAvatar-Bi96YrWD.js";import"./index-Dsh9-iej.js";import"./differenceInCalendarDays-qwJqrl5B.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=ce("Syringe",[["path",{d:"m18 2 4 4",key:"22kx64"}],["path",{d:"m17 7 3-3",key:"1w1zoj"}],["path",{d:"M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5",key:"1exhtz"}],["path",{d:"m9 11 4 4",key:"rovt3i"}],["path",{d:"m5 19-3 3",key:"59f2uf"}],["path",{d:"m14 4 6 6",key:"yqp9t2"}]]);function he(d){const{user:u}=$(),l=B(),g=z({queryKey:["vaccinations",d],queryFn:async()=>{if(!u||!d)return[];const{data:i,error:r}=await w.from("pet_vaccinations").select("*").eq("pet_id",d).order("date_administered",{ascending:!1});if(r)throw r;return(i||[]).map(a=>({id:a.id,petId:a.pet_id,vaccineName:a.vaccine_name,dateAdministered:a.date_administered,nextDue:a.next_due||void 0,vetName:a.vet_name||void 0,clinic:a.clinic||void 0,lotNumber:a.lot_number||void 0,documentUrl:a.document_url||void 0,notes:a.notes||void 0,createdAt:a.created_at}))},enabled:!!u&&!!d}),p=_({mutationFn:async i=>{if(!u)throw new Error("Not authenticated");const{data:r,error:a}=await w.from("pet_vaccinations").insert({user_id:u.id,pet_id:i.petId,vaccine_name:i.vaccineName,date_administered:i.dateAdministered,next_due:i.nextDue||null,vet_name:i.vetName||null,clinic:i.clinic||null,lot_number:i.lotNumber||null,document_url:i.documentUrl||null,notes:i.notes||null}).select().single();if(a)throw a;return r},onSuccess:()=>{l.invalidateQueries({queryKey:["vaccinations",d]})}}),y=_({mutationFn:async i=>{if(!u)throw new Error("Not authenticated");const{error:r}=await w.from("pet_vaccinations").delete().eq("id",i);if(r)throw r},onSuccess:()=>{l.invalidateQueries({queryKey:["vaccinations",d]})}});return{records:g.data??[],isLoading:g.isLoading,createRecord:p.mutateAsync,isSaving:p.isPending,deleteRecord:y.mutateAsync,isDeleting:y.isPending}}function pe(d){const{user:u}=$(),l=B(),g=z({queryKey:["health_certificates",d],queryFn:async()=>{if(!u||!d)return[];const{data:i,error:r}=await w.from("pet_health_certificates").select("*").eq("pet_id",d).order("issued_at",{ascending:!1});if(r)throw r;return(i||[]).map(a=>({id:a.id,petId:a.pet_id,title:a.title,issuedAt:a.issued_at,expiresAt:a.expires_at||void 0,vetName:a.vet_name||void 0,clinic:a.clinic||void 0,documentUrl:a.document_url||void 0,notes:a.notes||void 0,createdAt:a.created_at}))},enabled:!!u&&!!d}),p=_({mutationFn:async i=>{if(!u)throw new Error("Not authenticated");const{data:r,error:a}=await w.from("pet_health_certificates").insert({user_id:u.id,pet_id:i.petId,title:i.title,issued_at:i.issuedAt,expires_at:i.expiresAt||null,vet_name:i.vetName||null,clinic:i.clinic||null,document_url:i.documentUrl||null,notes:i.notes||null}).select().single();if(a)throw a;return r},onSuccess:()=>{l.invalidateQueries({queryKey:["health_certificates",d]})}}),y=_({mutationFn:async i=>{if(!u)throw new Error("Not authenticated");const{error:r}=await w.from("pet_health_certificates").delete().eq("id",i);if(r)throw r},onSuccess:()=>{l.invalidateQueries({queryKey:["health_certificates",d]})}});return{records:g.data??[],isLoading:g.isLoading,createRecord:p.mutateAsync,isSaving:p.isPending,deleteRecord:y.mutateAsync,isDeleting:y.isPending}}function Ve(){const{pets:d,selectedPet:u,selectedPetId:l,setSelectedPetId:g}=le(),{records:p,isLoading:y,createRecord:i,deleteRecord:r,isSaving:a}=he(l),{records:S,isLoading:I,createRecord:G,deleteRecord:J,isSaving:k}=pe(l),[W,A]=N.useState(!1),[X,D]=N.useState(!1),[s,v]=N.useState({vaccineName:"",dateAdministered:f(new Date,"yyyy-MM-dd"),nextDue:"",vetName:"",clinic:"",lotNumber:"",documentUrl:"",notes:""}),[n,x]=N.useState({title:"",issuedAt:f(new Date,"yyyy-MM-dd"),expiresAt:"",vetName:"",clinic:"",documentUrl:"",notes:""}),C=y||I,{uploadPhoto:Y,isUploading:M}=K(),{uploadPhoto:Z,isUploading:V}=K(),q=N.useRef(null),R=N.useRef(null),ee=async t=>{var b;if(!l){c({title:"Select a pet first",variant:"destructive"}),t.target.value="";return}const o=(b=t.target.files)==null?void 0:b[0];if(!o)return;const h=await Y(o,"documents",`vaccinations/${l}`);h?(v(U=>({...U,documentUrl:h})),c({title:"Attachment uploaded"})):c({title:"Upload failed",variant:"destructive"}),t.target.value=""},te=async t=>{var b;if(!l){c({title:"Select a pet first",variant:"destructive"}),t.target.value="";return}const o=(b=t.target.files)==null?void 0:b[0];if(!o)return;const h=await Z(o,"documents",`certificates/${l}`);h?(x(U=>({...U,documentUrl:h})),c({title:"Attachment uploaded"})):c({title:"Upload failed",variant:"destructive"}),t.target.value=""},ae=async()=>{if(!l){c({title:"Select a pet first",variant:"destructive"});return}if(!s.vaccineName){c({title:"Vaccine name is required",variant:"destructive"});return}try{await i({petId:l,vaccineName:s.vaccineName,dateAdministered:s.dateAdministered,nextDue:s.nextDue||void 0,vetName:s.vetName||void 0,clinic:s.clinic||void 0,lotNumber:s.lotNumber||void 0,documentUrl:s.documentUrl||void 0,notes:s.notes||void 0}),c({title:"Vaccination saved"}),A(!1),v({vaccineName:"",dateAdministered:f(new Date,"yyyy-MM-dd"),nextDue:"",vetName:"",clinic:"",lotNumber:"",documentUrl:"",notes:""})}catch(t){const o=t instanceof Error?t.message:"Something went wrong";c({title:"Unable to save vaccination",description:o,variant:"destructive"})}},ie=async()=>{if(!l){c({title:"Select a pet first",variant:"destructive"});return}if(!n.title){c({title:"Certificate title is required",variant:"destructive"});return}try{await G({petId:l,title:n.title,issuedAt:n.issuedAt,expiresAt:n.expiresAt||void 0,vetName:n.vetName||void 0,clinic:n.clinic||void 0,documentUrl:n.documentUrl||void 0,notes:n.notes||void 0}),c({title:"Certificate saved"}),D(!1),x({title:"",issuedAt:f(new Date,"yyyy-MM-dd"),expiresAt:"",vetName:"",clinic:"",documentUrl:"",notes:""})}catch(t){const o=t instanceof Error?t.message:"Something went wrong";c({title:"Unable to save certificate",description:o,variant:"destructive"})}},se=async t=>{try{await r(t),c({title:"Vaccination removed"})}catch(o){const h=o instanceof Error?o.message:"Something went wrong";c({title:"Delete failed",description:h,variant:"destructive"})}},ne=async t=>{try{await J(t),c({title:"Certificate removed"})}catch(o){const h=o instanceof Error?o.message:"Something went wrong";c({title:"Delete failed",description:h,variant:"destructive"})}};return e.jsxs(re,{children:[e.jsx(de,{title:"Health Records",subtitle:"Track vaccinations and vet-issued certificates."}),e.jsxs(oe,{className:"space-y-6 pb-24",children:[e.jsx(ue,{pets:d,selectedPetId:l,onSelectPet:g,showAddButton:!1}),!u&&e.jsx("div",{className:"p-4 rounded-xl bg-card-muted text-sm text-muted-foreground",children:"Add a pet to start tracking health records."}),u&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Vaccinations"}),e.jsx("h3",{className:"text-lg font-display font-semibold",children:"Timeline"})]}),e.jsxs(L,{open:W,onOpenChange:A,children:[e.jsxs(j,{variant:"secondary",size:"sm",className:"flex items-center gap-1",onClick:()=>A(!0),children:[e.jsx(O,{className:"w-4 h-4"})," Add"]}),e.jsxs(F,{children:[e.jsxs(E,{children:[e.jsx(T,{children:"Log vaccination"}),e.jsx(H,{children:"Store proof of shots for quick reference."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Vaccine name",value:s.vaccineName,onChange:t=>v({...s,vaccineName:t.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{type:"date",value:s.dateAdministered,onChange:t=>v({...s,dateAdministered:t.target.value})}),e.jsx(m,{type:"date",placeholder:"Next due",value:s.nextDue,onChange:t=>v({...s,nextDue:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{placeholder:"Vet name",value:s.vetName,onChange:t=>v({...s,vetName:t.target.value})}),e.jsx(m,{placeholder:"Clinic",value:s.clinic,onChange:t=>v({...s,clinic:t.target.value})})]}),e.jsx(m,{placeholder:"Lot number",value:s.lotNumber,onChange:t=>v({...s,lotNumber:t.target.value})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",ref:q,accept:"image/*,.pdf",className:"hidden",onChange:ee}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>{var t;return(t=q.current)==null?void 0:t.click()},disabled:M,className:"w-full",children:M?"Uploading…":s.documentUrl?"Replace attachment":"Upload document/photo"}),s.documentUrl&&e.jsxs("div",{className:"text-xs flex items-center justify-between",children:[e.jsx("a",{href:s.documentUrl,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"View current attachment"}),e.jsx("button",{type:"button",className:"text-destructive",onClick:()=>v(t=>({...t,documentUrl:""})),children:"Remove"})]})]}),e.jsx(P,{placeholder:"Notes",value:s.notes,onChange:t=>v({...s,notes:t.target.value})}),e.jsx(j,{onClick:ae,disabled:a,children:a?"Saving…":"Save vaccination"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[C&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading records…"}),!C&&p.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No vaccinations logged yet."}),p.map(t=>e.jsxs("div",{className:"rounded-xl border border-border p-3 bg-background/60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent-blue/30 flex items-center justify-center",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.vaccineName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Given ",f(new Date(t.dateAdministered),"MMM d, yyyy"),t.nextDue&&` • Next due ${f(new Date(t.nextDue),"MMM d, yyyy")}`]})]})]}),e.jsx("button",{onClick:()=>se(t.id),className:"p-2 rounded-lg text-muted-foreground hover:text-destructive",children:e.jsx(Q,{className:"w-4 h-4"})})]}),(t.vetName||t.clinic||t.notes)&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground space-y-1",children:[t.vetName&&e.jsxs("p",{children:["Vet: ",t.vetName,t.clinic?` @ ${t.clinic}`:""]}),t.notes&&e.jsx("p",{children:t.notes}),t.documentUrl&&e.jsx("a",{href:t.documentUrl,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"View document"})]})]},t.id))]})]}),e.jsxs("section",{className:"card-nude space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground uppercase tracking-wide",children:"Certificates"}),e.jsx("h3",{className:"text-lg font-display font-semibold",children:"Health documents"})]}),e.jsxs(L,{open:X,onOpenChange:D,children:[e.jsxs(j,{variant:"secondary",size:"sm",className:"flex items-center gap-1",onClick:()=>D(!0),children:[e.jsx(O,{className:"w-4 h-4"})," Add"]}),e.jsxs(F,{children:[e.jsxs(E,{children:[e.jsx(T,{children:"Upload certificate"}),e.jsx(H,{children:"Log vet-issued certificates or travel docs."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{placeholder:"Document title",value:n.title,onChange:t=>x({...n,title:t.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{type:"date",value:n.issuedAt,onChange:t=>x({...n,issuedAt:t.target.value})}),e.jsx(m,{type:"date",placeholder:"Expires",value:n.expiresAt,onChange:t=>x({...n,expiresAt:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{placeholder:"Vet name",value:n.vetName,onChange:t=>x({...n,vetName:t.target.value})}),e.jsx(m,{placeholder:"Clinic",value:n.clinic,onChange:t=>x({...n,clinic:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",ref:R,accept:"image/*,.pdf",className:"hidden",onChange:te}),e.jsx(j,{type:"button",variant:"outline",onClick:()=>{var t;return(t=R.current)==null?void 0:t.click()},disabled:V,className:"w-full",children:V?"Uploading…":n.documentUrl?"Replace attachment":"Upload document/photo"}),n.documentUrl&&e.jsxs("div",{className:"text-xs flex items-center justify-between",children:[e.jsx("a",{href:n.documentUrl,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"View current attachment"}),e.jsx("button",{type:"button",className:"text-destructive",onClick:()=>x(t=>({...t,documentUrl:""})),children:"Remove"})]})]}),e.jsx(P,{placeholder:"Notes",value:n.notes,onChange:t=>x({...n,notes:t.target.value})}),e.jsx(j,{onClick:ie,disabled:k,children:k?"Saving…":"Save certificate"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[C&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading documents…"}),!C&&S.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No certificates uploaded yet."}),S.map(t=>e.jsxs("div",{className:"rounded-xl border border-border p-3 bg-background/60",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent-pink/40 flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Issued ",f(new Date(t.issuedAt),"MMM d, yyyy"),t.expiresAt&&` • Expires ${f(new Date(t.expiresAt),"MMM d, yyyy")}`]})]})]}),e.jsx("button",{onClick:()=>ne(t.id),className:"p-2 rounded-lg text-muted-foreground hover:text-destructive",children:e.jsx(Q,{className:"w-4 h-4"})})]}),(t.vetName||t.notes)&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground space-y-1",children:[t.vetName&&e.jsxs("p",{children:["Vet: ",t.vetName,t.clinic?` @ ${t.clinic}`:""]}),t.notes&&e.jsx("p",{children:t.notes}),t.documentUrl&&e.jsx("a",{href:t.documentUrl,target:"_blank",rel:"noreferrer",className:"text-primary underline",children:"View certificate"})]})]},t.id))]})]})]})]}),e.jsx(me,{})]})}export{Ve as default};
